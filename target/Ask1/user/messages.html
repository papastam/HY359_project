<script>
    function sendmessage(event) {
        event.preventDefault();
    }

    function openchat(doctor_id) {
        var xhr = new XMLHttpRequest();
        xhr.onload = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                var reply = JSON.parse(xhr.responseText);
                // if(jQuery.isEmptyObject(reply)){


                console.log(reply);
            }
        }

        xhr.open('GET', '/Project_war_exploded/MessagesAPI?doctor_id=' + doctor_id + "&user_id=" + userdata["user_id"]);
        xhr.setRequestHeader("Content-type", "application/json");
        xhr.send("");
    }

    function printdoctortable() {
        var xhr = new XMLHttpRequest();
        xhr.onload = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                var jsonreply = JSON.parse(xhr.responseText);
                console.log(jsonreply);
                for (var index in jsonreply["doctors"]) {
                    var doc = JSON.parse(jsonreply["doctors"][index]);
                    if (doc["certified"] != 1) {
                        continue;
                    }
                    console.log(doc);

                    $("#docstable").append('<tr id="doctable_r' + index + '"></tr>');

                    $("#doctable_r" + index).append('<td>' + doc["firstname"] + ' ' + doc["lastname"] + '</td>');
                    $("#doctable_r" + index).append('<td>' + doc["specialty"] + '</td>');
                    $("#doctable_r" + index).append('<td>' + doc["telephone"] + '</td>');
                    $("#doctable_r" + index).append('<td>' + doc["address"] + ", " + doc["city"] + ", " + doc["country"] + '</td>');
                    $("#doctable_r" + index).append('<td>' + doc["email"] + '</td>');
                    $("#doctable_r" + index).append('<td>' + doc["doctor_info"] + '</td>');
                    $("#doctable_r" + index).append('<td class="doctablecell"><input type="button" value="Open Chat" onclick="openchat(\'' + doc["doctor_id"] + '\')" </td>');
                }
            }
        }

        xhr.open('GET', '/Project_war_exploded/CertifiedDoctorBoy?certified=1');
        xhr.setRequestHeader("Content-type", "application/json");
        xhr.send("");
    }

    $(document).ready(function () {
        printdoctortable();
    });

</script>
<header className="title">
    <h4>Select a doctor to chat with:</h4>
</header>
<br>
<table id="docstable">
    <thead id="doctablehead">
    <td>Name</td>
    <td>Specialty</td>
    <td>Telephone</td>
    <td>Address</td>
    <td>Email</td>
    <td>Doctor Info</td>
    </thead>

</table>

<div id="messageswindow">
    <div id="messages">
        <div class="message_container">
            <div id="message user_message">
            Hello!
            </div>
        </div>
        <div class="message_container">
            <div id="message doctor_message">
                Hi!
            </div>
        </div>
    </div>
    <div id="messagecontols">
        <form onSubmit="sendmessage(event);">
            <input type="text" id="messageinput" name="messagetosend" placeholder="Enter your message">
            <input type="submit" value="Send">
        </form>
    </div>
</div>